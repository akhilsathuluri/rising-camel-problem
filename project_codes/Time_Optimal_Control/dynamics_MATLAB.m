function[tor1,tor2,tor3] = sixbar(th1,th2,th3,dth1,dth2,dth3,ph1,ph2)
t = [1;1;1;1;1];
M=[0.130769E1,0.755455E0.*cos(ph1+(-1).*th3),0.84823E0.*cos(ph1+(-1) ...
.*th1),0.E-307,0.E-307;0.755455E0.*cos(ph1+(-1).*th3),0.536771E0, ...
0.636173E0.*cos(th1+(-1).*th3),0.E-307,0.E-307;0.84823E0.*cos(ph1+ ...
(-1).*th1),0.636173E0.*cos(th1+(-1).*th3),0.113097E1,0.E-307, ...
  0.E-307;0.E-307,0.E-307,0.E-307,0.459458E0,0.119282E0.*cos(ph2+( ...
 -1).*th2);0.E-307,0.E-307,0.E-307,0.119282E0.*cos(ph2+(-1).*th2), ...
0.596412E-1];

jacobi= [(-2).*cos(th1).*sin(ph2).*(cos(ph2).*sin(ph1)+(-1).*cos(ph1).* ...
 sin(ph2)).^(-1)+2.*cos(ph2).*(cos(ph2).*sin(ph1)+(-1).*cos(ph1).* ...
sin(ph2)).^(-1).*sin(th1),0.75E0.*cos(th2).*sin(ph2).*(cos(ph2).* ...
sin(ph1)+(-1).*cos(ph1).*sin(ph2)).^(-1)+(-0.75E0).*cos(ph2).*( ...
cos(ph2).*sin(ph1)+(-1).*cos(ph1).*sin(ph2)).^(-1).*sin(th2),( ...
 -0.75E0).*cos(th3).*sin(ph2).*(cos(ph2).*sin(ph1)+(-1).*cos(ph1).* ...
sin(ph2)).^(-1)+0.75E0.*cos(ph2).*(cos(ph2).*sin(ph1)+(-1).*cos( ...
ph1).*sin(ph2)).^(-1).*sin(th3);(-2).*cos(th1).*sin(ph1).*(cos( ...
ph2).*sin(ph1)+(-1).*cos(ph1).*sin(ph2)).^(-1)+2.*cos(ph1).*(cos( ...
ph2).*sin(ph1)+(-1).*cos(ph1).*sin(ph2)).^(-1).*sin(th1),0.75E0.* ...
cos(th2).*sin(ph1).*(cos(ph2).*sin(ph1)+(-1).*cos(ph1).*sin(ph2)) ...
.^(-1)+(-0.75E0).*cos(ph1).*(cos(ph2).*sin(ph1)+(-1).*cos(ph1).* ...
sin(ph2)).^(-1).*sin(th2),(-0.75E0).*cos(th3).*sin(ph1).*(cos(ph2) ...
.*sin(ph1)+(-1).*cos(ph1).*sin(ph2)).^(-1)+0.75E0.*cos(ph1).*(cos( ...
ph2).*sin(ph1)+(-1).*cos(ph1).*sin(ph2)).^(-1).*sin(th3)];




mat=jacobi*[dth1;dth2;dth3];
dph1 = mat(1);
dph2 = mat(2);

C = [0.E-307,0.755455E0.*dth3.*sin(ph1+(-1).*th3),0.E-307+0.84823E0.* ...
dth1.*sin(ph1+(-1).*th1),0,0;(-0.755455E0).*dph1.*sin(ph1+(-1).* ...
th3),0.E-307,0.E-307+(-0.636173E0).*dth1.*sin(th1+(-1).*th3),0,0; ...
0.E-307+(-0.84823E0).*dph1.*sin(ph1+(-1).*th1),0.E-307+ ...
  0.636173E0.*dth3.*sin(th1+(-1).*th3),0.E-307,0,0;0,0,0,0.E-307, ...
  0.E-307+0.119282E0.*dth2.*sin(ph2+(-1).*th2);0,0,0,0.E-307+( ...
  -0.119282E0).*dph2.*sin(ph2+(-1).*th2),0.E-307];

G = [0.270327E2.*cos(ph1),0.14816E2.*cos(th3),0.166355E2.*cos(th1), ...
 0.103972E2.*cos(ph2),0.233937E1.*cos(th2)];

Jeq =[(-1).*sin(ph1),(-0.75E0).*sin(th3),(-2).*sin(th1),sin(ph2), ...
  0.75E0.*sin(th2);cos(ph1),0.75E0.*cos(th3),2.*cos(th1),(-1).*cos( ...
ph2),(-0.75E0).*cos(th2)];

Jdot=[(-1).*dph1.*cos(ph1),(-0.75E0).*dth3.*cos(th3),(-2).*dth1.*cos( ...
th1),dph2.*cos(ph2),0.75E0.*dth2.*cos(th2);(-1).*dph1.*sin(ph1),( ...
-0.75E0).*dth3.*sin(th3),(-2).*dth1.*sin(th1),dph2.*sin(ph2), ...
  0.75E0.*dth2.*sin(th2)];

qd = [dph1;dth3;dth1;dph2;dth2];

A = Jeq/(M)*transpose(Jeq);
B = eye(5)-transpose(Jeq)/A*Jeq/M;
alp = pinv(B)*M;
beta = pinv(B)*transpose(Jeq)/(A)*Jdot*qd+G+C*qd;
torq=alp*t+beta;
tor1 = torq(2);
tor2 = torq(3);
tor3 = torq(4);
end




 
   